{
  "dashboard": {
    "style": "dark",
    "editable": true,
    "graphTooltip": 0,
    "schemaVersion": 36,
    "templating": {},
    "annotations": {},
    "uid": "payment-api-overview",
    "title": "payment-api - Service Dashboard",
    "description": "Auto-generated dashboard for payment-api service",
    "tags": [
      "payments",
      "critical",
      "api"
    ],
    "timezone": "browser",
    "time": {
      "from": "now-6h",
      "to": "now"
    },
    "fiscalYearStartMonth": 0,
    "panels": [
      {
        "type": "timeseries",
        "transparent": false,
        "transformations": [],
        "options": null,
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "targets": [
          {
            "expr": "sum(rate(http_requests{service=\"$service\",code!~\"5..\"}[5m]))\n/\nsum(rate(http_requests{service=\"$service\"}[5m]))\n",
            "refId": "A",
            "legendFormat": "availability"
          }
        ],
        "title": "availability",
        "description": "Target: 99.95%",
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 0,
          "y": 0
        },
        "repeatDirection": "h"
      },
      {
        "type": "timeseries",
        "transparent": false,
        "transformations": [],
        "options": null,
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "targets": [
          {
            "expr": "histogram_quantile(0.95,\n  rate(http_request_duration_seconds_bucket{service=\"$service\"}[5m])\n)\n",
            "refId": "A",
            "legendFormat": "latency-p95"
          }
        ],
        "title": "latency-p95",
        "description": "Target: 99.0%",
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 12,
          "y": 0
        },
        "repeatDirection": "h"
      },
      {
        "type": "timeseries",
        "transparent": false,
        "transformations": [],
        "options": null,
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "targets": [
          {
            "expr": "rate(http_requests_total{service=\"$service\"}[5m])",
            "refId": "A"
          }
        ],
        "title": "latency-p99",
        "description": "Target: 95.0%",
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 0,
          "y": 9
        },
        "repeatDirection": "h"
      },
      {
        "type": "timeseries",
        "transparent": false,
        "transformations": [],
        "options": null,
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "targets": [
          {
            "expr": "sum(rate(http_requests_total{service=\"$service\"}[5m]))",
            "refId": "A",
            "legendFormat": "requests/sec"
          }
        ],
        "title": "Request Rate",
        "description": "Total requests per second",
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 12,
          "y": 9
        },
        "repeatDirection": "h"
      },
      {
        "type": "timeseries",
        "transparent": false,
        "transformations": [],
        "options": null,
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "targets": [
          {
            "expr": "sum(rate(http_requests_total{service=\"$service\",status=~\"5..\"}[5m])) / sum(rate(http_requests_total{service=\"$service\"}[5m])) * 100",
            "refId": "A",
            "legendFormat": "error %"
          }
        ],
        "title": "Error Rate",
        "description": "Percentage of requests returning 5xx",
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 0,
          "y": 18
        },
        "repeatDirection": "h"
      },
      {
        "type": "timeseries",
        "transparent": false,
        "transformations": [],
        "options": null,
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum by (le) (rate(http_request_duration_seconds_bucket{service=\"$service\"}[5m])))",
            "refId": "A",
            "legendFormat": "p95 latency"
          }
        ],
        "title": "Request Latency (p95)",
        "description": "95th percentile request duration",
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 12,
          "y": 18
        },
        "repeatDirection": "h"
      },
      {
        "type": "timeseries",
        "transparent": false,
        "transformations": [],
        "options": null,
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "targets": [
          {
            "expr": "pg_stat_database_numbackends{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"}",
            "refId": "A",
            "legendFormat": "{{datname}} connections"
          },
          {
            "expr": "pg_settings_max_connections{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"}",
            "refId": "A",
            "legendFormat": "Max connections"
          }
        ],
        "title": "PostgreSQL Connections",
        "description": "Active database connections vs max connections limit",
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 0,
          "y": 27
        },
        "repeatDirection": "h"
      },
      {
        "type": "timeseries",
        "transparent": false,
        "transformations": [],
        "options": null,
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "targets": [
          {
            "expr": "pg_stat_activity_count{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\",state=\"active\"}",
            "refId": "A",
            "legendFormat": "Active queries"
          },
          {
            "expr": "pg_stat_activity_count{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\",state=\"idle\"}",
            "refId": "A",
            "legendFormat": "Idle connections"
          }
        ],
        "title": "Active Queries",
        "description": "Number of currently executing queries",
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 12,
          "y": 27
        },
        "repeatDirection": "h"
      },
      {
        "type": "gauge",
        "transparent": false,
        "transformations": [],
        "options": null,
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "targets": [
          {
            "expr": "sum(pg_stat_database_blks_hit{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"}) / (sum(pg_stat_database_blks_hit{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"}) + sum(pg_stat_database_blks_read{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"})) * 100",
            "refId": "A",
            "legendFormat": "Cache hit %"
          }
        ],
        "title": "Cache Hit Ratio",
        "description": "Buffer cache hit ratio - should be >99% for good performance",
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 0,
          "y": 36
        },
        "repeatDirection": "h"
      },
      {
        "type": "timeseries",
        "transparent": false,
        "transformations": [],
        "options": null,
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "targets": [
          {
            "expr": "rate(pg_stat_database_xact_commit{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"}[5m])",
            "refId": "A",
            "legendFormat": "{{datname}} commits/sec"
          },
          {
            "expr": "rate(pg_stat_database_xact_rollback{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"}[5m])",
            "refId": "A",
            "legendFormat": "{{datname}} rollbacks/sec"
          }
        ],
        "title": "Transaction Rate",
        "description": "Transaction commits and rollbacks per second",
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 12,
          "y": 36
        },
        "repeatDirection": "h"
      },
      {
        "type": "timeseries",
        "transparent": false,
        "transformations": [],
        "options": null,
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "targets": [
          {
            "expr": "pg_database_size_bytes{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"}",
            "refId": "A",
            "legendFormat": "{{datname}} size"
          }
        ],
        "title": "Database Size",
        "description": "Total database size in bytes",
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 0,
          "y": 45
        },
        "repeatDirection": "h"
      },
      {
        "type": "timeseries",
        "transparent": false,
        "transformations": [],
        "options": null,
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(pg_stat_statements_mean_exec_time_seconds_bucket{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"}[5m]))",
            "refId": "A",
            "legendFormat": "p95 query time"
          },
          {
            "expr": "histogram_quantile(0.99, rate(pg_stat_statements_mean_exec_time_seconds_bucket{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"}[5m]))",
            "refId": "A",
            "legendFormat": "p99 query time"
          }
        ],
        "title": "Query Duration (p95)",
        "description": "Query execution time percentiles",
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 12,
          "y": 45
        },
        "repeatDirection": "h"
      },
      {
        "type": "timeseries",
        "transparent": false,
        "transformations": [],
        "options": null,
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "targets": [
          {
            "expr": "rate(pg_stat_database_deadlocks{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"}[5m])",
            "refId": "A",
            "legendFormat": "{{datname}} deadlocks/sec"
          }
        ],
        "title": "Deadlocks",
        "description": "Deadlocks per second - should be near zero",
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 0,
          "y": 54
        },
        "repeatDirection": "h"
      },
      {
        "type": "timeseries",
        "transparent": false,
        "transformations": [],
        "options": null,
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "targets": [
          {
            "expr": "pg_replication_lag_seconds{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"}",
            "refId": "A",
            "legendFormat": "{{replica}} lag"
          }
        ],
        "title": "Replication Lag",
        "description": "Replication lag in seconds - should be <1s",
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 12,
          "y": 54
        },
        "repeatDirection": "h"
      },
      {
        "type": "timeseries",
        "transparent": false,
        "transformations": [],
        "options": null,
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "targets": [
          {
            "expr": "rate(pg_stat_database_blks_read{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"}[5m])",
            "refId": "A",
            "legendFormat": "{{datname}} disk reads/sec"
          },
          {
            "expr": "rate(pg_stat_database_blks_hit{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"}[5m])",
            "refId": "A",
            "legendFormat": "{{datname}} cache hits/sec"
          }
        ],
        "title": "Disk I/O",
        "description": "Disk I/O vs cache hits - cache should dominate",
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 0,
          "y": 63
        },
        "repeatDirection": "h"
      },
      {
        "type": "timeseries",
        "transparent": false,
        "transformations": [],
        "options": null,
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "targets": [
          {
            "expr": "pg_table_bloat_ratio{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"}",
            "refId": "A",
            "legendFormat": "{{table}} bloat %"
          }
        ],
        "title": "Table Bloat",
        "description": "Table bloat percentage - vacuum if >20%",
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 12,
          "y": 63
        },
        "repeatDirection": "h"
      },
      {
        "type": "gauge",
        "transparent": false,
        "transformations": [],
        "options": null,
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "targets": [
          {
            "expr": "sum(pg_stat_user_indexes_idx_scan{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"}) / (sum(pg_stat_user_indexes_idx_scan{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"}) + sum(pg_stat_user_tables_seq_scan{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"})) * 100",
            "refId": "A",
            "legendFormat": "Index usage %"
          }
        ],
        "title": "Index Hit Ratio",
        "description": "Percentage of queries using indexes vs sequential scans",
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 0,
          "y": 72
        },
        "repeatDirection": "h"
      },
      {
        "type": "timeseries",
        "transparent": false,
        "transformations": [],
        "options": null,
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "targets": [
          {
            "expr": "pg_stat_database_numbackends{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"} / pg_settings_max_connections{service=\"ServiceContext(name='payment-api', team='payments', tier='critical', type='api', language='java', framework='spring-boot', template=None, environment=None, metadata={})\"} * 100",
            "refId": "A",
            "legendFormat": "Pool usage %"
          }
        ],
        "title": "Connection Pool Utilization",
        "description": "Connection pool utilization percentage",
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 12,
          "y": 72
        },
        "repeatDirection": "h"
      }
    ]
  },
  "overwrite": true,
  "message": "Auto-generated dashboard for payment-api"
}